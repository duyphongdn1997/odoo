<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!--
            Integrate Livechat Conversation in the Discuss
        -->
        <!--
            Template rendering the external HTML support page
        -->
        <template id="support_page" name="Livechat : Support Page">
            <html lang="en">
                <head>
                    <script src="https://cdn.jsdelivr.net/npm/rasa-webchat@1.0.1/lib/index.js" async=""> </script>
                    <title>JAVisBe Bot</title>
                </head>
                <a id="sid"><t t-esc="sender_id"/></a>
                <a id="title_box"><t t-esc="title"/></a>
                <body>
                    <script>!(
                                function (require) {
                                    let e = document.createElement("script"),
                                        t = document.head || document.getElementsByTagName("head")[0];
                                    let sid = document.getElementById("sid").value;
                                    let title_box = document.getElementById("title_box").value;
                                    (e.src = "https://cdn.jsdelivr.net/npm/rasa-webchat@1.0.1/lib/index.js"),
                                        (e.async = !0),
                                        (e.onload = () => {
                                            window.WebChat.default({
                                                    customData: {
                                                        "sender_id": sid,
                                                    },
                                                    socketUrl: "http://localhost:5005",
                                                    fullScreenMode: false,
                                                    showCloseButton: true,
                                                    showFullScreenButton: true,
                                                    showMessageDate: true,
                                                    // badge: 1,
                                                    customMessageDelay: (message) => {
                                                        let delay = message.length * 20;
                                                        if (delay > 3000) delay = 3000;
                                                        return delay;
                                                    },
                                                    displayUnreadCount: true,
                                                    //initPayload:,
                                                    title: title_box,
                                                    sub
                                                    profileAvatar: "static/src/img/bot.png",
                                                    params: {
                                                            "images": {
                                                                "dims": {
                                                                    "width": 300,
                                                                    "height": 200,
                                                                      }
                                                                    }
                                                            }
                                                    // add other props here
                                                },
                                                null
                                            );
                                        }),
                                        t.insertBefore(e, t.firstChild);
                                })
                            ();
                    </script>


                    <div id="rasaWebchatPro">
                        <div class="" style="">
                            <div class="rw-widget-container">
                                <button type="button" class="rw-launcher">
                                    <div class="rw-open-launcher__container">
                                        <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTI7IiB4bWw6c3BhY2U9InByZXNlcnZlIiB3aWR0aD0iNTEycHgiIGhlaWdodD0iNTEycHgiIGNsYXNzPSIiPjxnIHRyYW5zZm9ybT0ibWF0cml4KDAuNzMyMzA0IDAgMCAwLjczMjMwNCA2OC41MzAzIDEyNC4yNTQpIj48cGF0aCBkPSJNNDQ4LDBINjRDMjguNzA0LDAsMCwyOC43MDQsMCw2NHYyODhjMCwzNS4yOTYsMjguNzA0LDY0LDY0LDY0aDMydjgwICBjMCw2LjIwOCwzLjU4NCwxMS44NzIsOS4yMTYsMTQuNDk2YzIuMTQ0LDAuOTkyLDQuNDgsMS41MDQsNi43ODQsMS41MDRjMy42OCwwLDcuMzI4LTEuMjgsMTAuMjQtMy43MTJMMjMyLjk5Miw0MTZINDQ4ICBjMzUuMjk2LDAsNjQtMjguNzA0LDY0LTY0VjY0QzUxMiwyOC43MDQsNDgzLjI5NiwwLDQ0OCwweiIgZGF0YS1vcmlnaW5hbD0iIzIxOTZGMyIgY2xhc3M9ImFjdGl2ZS1wYXRoIiBkYXRhLW9sZF9jb2xvcj0iIzIxOTZGMyIgZmlsbD0iI0Y2RjZGNiIvPjwvZz4gPC9zdmc+Cg==" class="rw-open-launcher" alt=""> </img>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                    <style>@keyframes default-botfront-blinker-animation {
                        0% {
                        outline-color: rgba(0,255,0,0);
                        }
                        49% {
                        outline-color: rgba(0,255,0,0);
                        }
                        50% {
                        outline-color:green;
                        }
                        100% {
                        outline-color: green;
                        }
                        }
                    </style>
                    <textarea tab-index="-1" aria-hidden="true"
                              style="min-height: 0px !important; max-height: none !important; height: 0px !important; visibility: hidden !important; overflow: hidden !important; position: absolute !important; z-index: -1000 !important; top: 0px !important; right: 0px !important; letter-spacing: normal; line-height: normal; font-family: Inter, sans-serif; font-weight: 400; font-size: 16px; font-style: normal; tab-size: 8; text-rendering: auto; text-transform: none; width: 306px; text-indent: 0px; padding: 2px 2px 2px 15px; border-width: 0px; box-sizing: content-box;"> </textarea>
                </body>
            </html>
        </template>

        <!--
            Template rendering all the scripts required to execute the Livechat from an external page (which not contain Odoo)
        -->
        <template id="external_loader" name="Livechat : external_script field of livechat channel">
            <!-- css style -->
            <link t-attf-href="{{url}}/im_livechat/external_lib.css" rel="stylesheet"/>
            <!-- js of all the required lib (internal and external) -->
            <script t-attf-src="{{url}}/im_livechat/external_lib.js" type="text/javascript"/>
            <!-- the loader -->
            <script t-attf-src="{{url}}/im_livechat/loader/{{channel_id}}" type="text/javascript"/>
        </template>

        <!-- the js code to initialize the LiveSupport object -->
        <template id="loader" name="Livechat : Javascript appending the livechat button">
            <t t-translation="off">
                window.addEventListener('load', function () {
                <t t-if="web_session_required">
                    odoo.define('web.session', function (require) {
                    var Session = require('web.Session');
                    var modules = odoo._modules;
                    return new Session(undefined, "<t t-esc="info['server_url']"/>", {modules:modules, use_cors: true});
                    });
                </t>

                odoo.define('im_livechat.livesupport', function (require) {
                <t t-if="info['available']" t-translation="off">
                    var rootWidget = require('root.widget');
                    var im_livechat = require('im_livechat.legacy.im_livechat.im_livechat');
                    var button = new im_livechat.LivechatButton(
                    rootWidget,
                    "<t t-esc="info['server_url']"/>",
                    <t t-out="json.dumps(info.get('options', {}))"/>
                    );
                    button.appendTo(document.body);
                    window.livechat_button = button;
                </t>
                });
                });
            </t>
        </template>


    </data>
</odoo>
